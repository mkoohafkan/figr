%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{figr-showcase}

figr showcase
---------

`figr` is designed to be a simple figure and table reference manager. This vignette shows how to use the package. 

First, create a figure:
```{r message=FALSE, warning=FALSE}
require(ggplot2)
p = qplot(rnorm(500),geom="histogram")
```

Now we use figr to index it:
```{r message=FALSE}
require(figr)
addFigure('example', p, caption='a histogram')
# note that figr makes a copy of the plot object
rm(p)
```
Cross-referencing can be achieved using the HTML anchor tag (`<a>`). We can define a new hook for anchoring a code block.

```{r results='hide', message=FALSE}
require(knitr)
knit_hooks$set(anchor = function(before, options, envir) {
    if (!before) 
	  paste('<a name="', options$anchor, '"></a>', sep='')
})
```

We can automatically generate an anchor that will match the figure citation with `anchorFigure('example')`. We are now ready to place the figure. Note that the code chunk below includes the option `anchor=anchorFigure('example')`. 

```{r message=FALSE, warning=FALSE, anchor=anchorFigure('example')}
placeFigure('example')
```

`figr` determines figure numbers by ranking them based on the order they are placed or cited in the document. We can reference `r citeFigure("example")` (I just did!) by typing `citeFigure("example")`. Note that the anchors are actually placed *below* the code chunk (placing them above would be preferable but I haven't figured out how to do this yet). 

Calling `placeFigure('example')` a second time will not change the rankings. This is the result of code that allows a figure to be cited before it is placed. A figure is not ranked until it is placed or cited, so if for some reason you need to refer to a later figure you must cite or place any intervening figures first. 

```{r message=FALSE, warning=FALSE}
# note you don't actually have to create a figure to cite it!
invisible(citeFigure('ex2'))
```

We'll get to `r citeFigure('ex3')` in a second, but first look at `r citeFigure('ex2')`:

```{r message=FALSE, warning=FALSE, anchor=anchorFigure('ex2')}
p2 = qplot(rlnorm(500),geom="histogram")
addFigure('ex2', p2, 'Another plot.')
placeFigure('ex2')
```

Okay, now for `r citeFigure('ex3')`:

```{r message=FALSE, warning=FALSE, anchor=anchorFigure('ex3')}
p3 = qplot(rgamma(500, 3), geom='histogram')
addFigure('ex3', p3, 'A third plot.')
placeFigure('ex3')
```

Note that automatic generation of a list of figures or list of tables is not possible. If you are creating a document that requires those features, you may want to consider using LaTeX instead of Markdown.

We can also add a hook for figure captions:

```{r results='hide'}
knit_hooks$set(plot = function(x, options) {
  paste('<figure><img src="',
        opts_knit$get('base.url'), paste(x, collapse = '.'),
        '"><figcaption>', options$fig.cap, '</figcaption></figure>',
        sep = '')
})
```

A figure caption can be referenced using `labelFigure`. Note that the figure caption does not include a link to the anchor. This is because I have not figured out a way to render markdown within the hook function (having the link in the caption is not really useful, but would be nice for labelling consistency or text formatting). Another issue is that the figure caption needs to be created in a prior code chunk.

```{r}
addFigure('ex4', qplot(rchisq(500, 3), geom='histogram'), 
          'I have to define the caption before I place a figure. :(')
```

Note that `r citeFigure('ex4')` below uses the chunk options `fig.cap=labelFigure('ex4')` and `anchor=anchorFigure('ex4')`
```{r anchor=anchorFigure('ex4'), fig.cap=labelFigure('ex4'), message=FALSE}
placeFigure('ex4')
```

The package provides identical support for tables (e.g. `addTable`, `citeTable`, etc.) for e.g. kable objects, as shown by `r citeTable('example')`. Note that tables can have identical names to figures without risk of overwriting.

```{r message=FALSE, warning=FALSE, results='asis', anchor=anchorTable('example')}
# note only the data is passed to addTable
d = head(iris[,1:3])
addTable('example', d, caption='a table.')
# code chunk option: results='asis'
kable(placeTable('example'))
```

There is currently no hook for a table caption code chunk option, but the`labelTable` function is defined in anticipation of such functionality.

Things on my TODO list:
* have `figr` check that an anchor has not already been created (what happens when you define duplicate anchors in a page?)
* Figure out `knitr` plot hooks so that you can define `fig.cap` within the code chunk (I don't know if this is possible).
* add argument `caption` to functions `labelFigure` and `labelTable` so that you can create the caption when you label it, even prior to placing or citing the figure or table (useful if previous item is impossible).
* figure out how to place the anchor at the top of a code block, rather than the bottom.
* Figure out table captions (nest a table and caption in a 2-cell table?)
